{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5 col-xl-4">
      <!-- Admin Login Card -->
      <div class="card admin-login-card border-0 shadow-lg overflow-hidden">
        <!-- Card Header with Security Gradient -->
        <div class="card-header bg-gradient-danger text-white text-center py-4 position-relative">
          <div class="header-background">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
          </div>
          <div class="security-badge position-absolute top-0 start-50 translate-middle">
            <i class="bi bi-shield-lock fs-4"></i>
          </div>
          <h2 class="mb-0 fw-bold mt-2">
            <i class="bi bi-shield-check me-2"></i>Admin Portal
          </h2>
          <p class="mb-0 mt-2 opacity-75">Restricted Access</p>
        </div>
        
        <!-- Card Body -->
        <div class="card-body p-4 p-md-5">
          <!-- Security Warning -->
          <div class="alert alert-danger border-danger bg-danger bg-opacity-10 d-flex align-items-center mb-4">
            <i class="bi bi-exclamation-triangle fs-5 me-3 text-danger"></i>
            <div>
              <h6 class="alert-heading mb-1 fw-bold">Authorized Personnel Only</h6>
              <p class="mb-0 small">This area contains sensitive system controls.</p>
            </div>
          </div>

          <!-- Flash Messages -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show mb-4" role="alert">
                  <i class="bi bi-{{ 'exclamation-triangle' if category == 'error' else 'shield-check' }}-fill me-2"></i>
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          <!-- Login Form -->
          <form method="post" class="needs-validation" novalidate id="adminLoginForm">
            <!-- Username Field -->
            <div class="form-group mb-4">
              <label for="username" class="form-label fw-semibold">
                <i class="bi bi-person-badge me-2 text-danger"></i>Admin Username
              </label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-light border-end-0">
                  <i class="bi bi-person-gear text-muted"></i>
                </span>
                <input 
                  type="text" 
                  class="form-control form-control-lg" 
                  id="username" 
                  name="username" 
                  placeholder="admin" 
                  required
                  autocomplete="username"
                >
                <span class="input-group-text bg-light border-start-0">
                  <i class="bi bi-building text-muted"></i>
                </span>
              </div>
              <div class="invalid-feedback">
                Please enter your admin username.
              </div>
            </div>

            <!-- Password Field -->
            <div class="form-group mb-4">
              <label for="password" class="form-label fw-semibold">
                <i class="bi bi-key me-2 text-danger"></i>Admin Password
              </label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-light border-end-0">
                  <i class="bi bi-lock text-muted"></i>
                </span>
                <input 
                  type="password" 
                  class="form-control form-control-lg" 
                  id="password" 
                  name="password" 
                  placeholder="admin123" 
                  required
                  autocomplete="current-password"
                >
                <button class="btn btn-outline-secondary border-start-0" type="button" id="togglePassword">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              <div class="invalid-feedback">
                Please enter your admin password.
              </div>
            </div>

            <!-- Security Check -->
            <div class="security-check mb-4 p-3 border rounded bg-light">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="confirmAccess" required>
                <label class="form-check-label small text-muted" for="confirmAccess">
                  I confirm that I am authorized to access the admin portal
                </label>
                <div class="invalid-feedback">
                  You must confirm your authorization to proceed.
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid mb-4">
              <button type="submit" class="btn btn-danger btn-lg py-3 fw-semibold shadow-sm">
                <i class="bi bi-shield-lock me-2"></i>
                Authenticate
                <span class="spinner-border spinner-border-sm ms-2 d-none" role="status"></span>
              </button>
            </div>

            <!-- Access Levels -->
            <div class="access-levels text-center mb-4">
              <h6 class="text-uppercase small fw-bold text-muted mb-3">Access Levels</h6>
              <div class="row g-2">
                <div class="col-4">
                  <div class="level-item p-2 border rounded bg-white">
                    <i class="bi bi-eye text-primary d-block fs-5"></i>
                    <small class="text-muted">View</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="level-item p-2 border rounded bg-white">
                    <i class="bi bi-pencil text-warning d-block fs-5"></i>
                    <small class="text-muted">Manage</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="level-item p-2 border rounded bg-white">
                    <i class="bi bi-gear text-danger d-block fs-5"></i>
                    <small class="text-muted">Configure</small>
                  </div>
                </div>
              </div>
            </div>
          </form>

          <!-- Back to Main Site -->
          <div class="text-center">
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-arrow-left me-1"></i>
              Back to Main Site
            </a>
          </div>
        </div>
      </div>

      <!-- Security Features -->
      <div class="row mt-4 g-3">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-body py-3">
              <div class="row text-center g-0">
                <div class="col-4 border-end">
                  <div class="security-feature">
                    <i class="bi bi-encrypt text-primary d-block fs-4 mb-1"></i>
                    <small class="text-muted">Encrypted</small>
                  </div>
                </div>
                <div class="col-4 border-end">
                  <div class="security-feature">
                    <i class="bi bi-clock-history text-warning d-block fs-4 mb-1"></i>
                    <small class="text-muted">Session Timeout</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="security-feature">
                    <i class="bi bi-activity text-success d-block fs-4 mb-1"></i>
                    <small class="text-muted">Activity Log</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Login Activity -->
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-body">
          <h6 class="card-title d-flex align-items-center mb-3">
            <i class="bi bi-graph-up me-2 text-primary"></i>Recent Activity
          </h6>
          <div class="activity-list small">
            <div class="activity-item d-flex justify-content-between text-muted mb-2">
              <span>Last successful login</span>
              <span>--:--</span>
            </div>
            <div class="activity-item d-flex justify-content-between text-muted mb-2">
              <span>Failed attempts (today)</span>
              <span>0</span>
            </div>
            <div class="activity-item d-flex justify-content-between text-muted">
              <span>Current session</span>
              <span>Not active</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
:root {
  --primary-color: #4361ee;
  --secondary-color: #3f37c9;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --success-color: #28a745;
  --info-color: #17a2b8;
}

.admin-login-card {
  border-radius: 1.5rem;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  background: white;
}

.admin-login-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15) !important;
}

.bg-gradient-danger {
  background: linear-gradient(135deg, #dc3545, #c82333) !important;
  position: relative;
  overflow: hidden;
}

.header-background {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}

.floating-shape {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  animation: float 6s ease-in-out infinite;
}

.shape-1 {
  width: 100px;
  height: 100px;
  top: -30px;
  left: -30px;
  animation-delay: 0s;
}

.shape-2 {
  width: 60px;
  height: 60px;
  bottom: -20px;
  right: 10%;
  animation-delay: 2s;
}

.shape-3 {
  width: 80px;
  height: 80px;
  top: 50%;
  right: -20px;
  animation-delay: 4s;
}

.security-badge {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

@keyframes float {
  0%, 100% {
    transform: translateY(0) rotate(0deg);
  }
  50% {
    transform: translateY(-15px) rotate(5deg);
  }
}

/* Form Styles */
.form-control {
  border-radius: 0.75rem;
  padding: 0.75rem 1rem;
  border: 1px solid #e2e8f0;
  transition: all 0.3s ease;
  font-family: 'Courier New', monospace;
}

.form-control:focus {
  border-color: var(--danger-color);
  box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
  transform: translateY(-2px);
}

.input-group-text {
  border-radius: 0.75rem 0 0 0.75rem;
  border: 1px solid #e2e8f0;
  border-right: none;
  background-color: #f8fafc;
  transition: all 0.3s ease;
}

.form-control:focus + .input-group-text,
.form-control:focus ~ .input-group-text {
  border-color: var(--danger-color);
  background-color: #ffe6e9;
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger-color), #c82333);
  border: none;
  border-radius: 0.75rem;
  font-weight: 600;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
}

.btn-danger::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn-danger:hover::before {
  left: 100%;
}

/* Security Check */
.security-check {
  border-color: #e9ecef !important;
  transition: all 0.3s ease;
}

.security-check:hover {
  border-color: var(--danger-color) !important;
  background-color: #fff5f5 !important;
}

/* Access Levels */
.level-item {
  transition: all 0.3s ease;
  cursor: default;
}

.level-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

/* Security Features */
.security-feature {
  transition: transform 0.3s ease;
}

.security-feature:hover {
  transform: scale(1.1);
}

/* Activity List */
.activity-list {
  font-family: 'Courier New', monospace;
}

.activity-item {
  padding: 0.25rem 0;
  border-bottom: 1px solid #f8f9fa;
}

.activity-item:last-child {
  border-bottom: none;
}

/* Alert Styles */
.alert {
  border: none;
  border-radius: 0.75rem;
  animation: slideInDown 0.5s ease;
}

@keyframes slideInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Card Animations */
.admin-login-card,
.card {
  animation: fadeInUp 0.8s ease;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Form validation */
.was-validated .form-control:valid {
  border-color: var(--success-color);
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right calc(0.375em + 0.1875rem) center;
  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.was-validated .form-control:invalid {
  border-color: var(--danger-color);
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4.4-.4'/%3e%3cpath d='M6 7v2'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right calc(0.375em + 0.1875rem) center;
  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

/* Security animations */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.shake {
  animation: shake 0.5s ease-in-out;
}

/* Responsive */
@media (max-width: 768px) {
  .card-body {
    padding: 2rem 1.5rem !important;
  }
  
  .card-header {
    padding: 2rem 1.5rem !important;
  }
  
  .security-badge {
    width: 50px;
    height: 50px;
  }
  
  .security-badge i {
    font-size: 1.25rem !important;
  }
}

/* Loading animation */
@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

.pulse {
  animation: pulse 2s infinite;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password visibility toggle
  const togglePassword = document.getElementById('togglePassword');
  const passwordInput = document.getElementById('password');
  
  if (togglePassword && passwordInput) {
    togglePassword.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
    });
  }
  
  // Form validation
  const form = document.getElementById('adminLoginForm');
  if (form) {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
        
        // Add shake animation to invalid fields
        const invalidFields = form.querySelectorAll('.form-control:invalid');
        invalidFields.forEach(field => {
          field.classList.add('shake');
          setTimeout(() => field.classList.remove('shake'), 500);
        });
      } else {
        // Show loading spinner
        const submitBtn = form.querySelector('button[type="submit"]');
        const spinner = submitBtn.querySelector('.spinner-border');
        submitBtn.disabled = true;
        spinner.classList.remove('d-none');
        
        // Simulate security check delay
        setTimeout(() => {
          // This would normally be handled by the form submission
          console.log('Admin login attempt processed');
        }, 1500);
      }
      form.classList.add('was-validated');
    }, false);
  }
  
  // Enhanced security features
  let failedAttempts = 0;
  const maxAttempts = 3;
  
  // Track failed attempts (simulated)
  form.addEventListener('submit', function(event) {
    // This would be handled by the backend in a real application
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    // Simulate failed login detection (for demo purposes)
    if (username === 'demo' && password === 'wrong') {
      failedAttempts++;
      updateSecurityStatus();
    }
  });
  
  function updateSecurityStatus() {
    const activityItems = document.querySelectorAll('.activity-item');
    if (activityItems.length > 1) {
      activityItems[1].innerHTML = `
        <span>Failed attempts (today)</span>
        <span class="text-danger">${failedAttempts}</span>
      `;
    }
    
    if (failedAttempts >= maxAttempts) {
      showSecurityAlert('Multiple failed login attempts detected. Account temporarily locked.');
    }
  }
  
  function showSecurityAlert(message) {
    const alert = document.createElement('div');
    alert.className = 'alert alert-warning alert-dismissible fade show';
    alert.innerHTML = `
      <i class="bi bi-shield-exclamation me-2"></i>
      ${message}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    form.parentNode.insertBefore(alert, form);
  }
  
  // Auto-focus username field
  document.getElementById('username').focus();
  
  // Add input monitoring for security
  const inputs = document.querySelectorAll('input[type="text"], input[type="password"]');
  inputs.forEach(input => {
    input.addEventListener('input', function() {
      // Clear any previous security warnings when user starts typing
      const securityAlerts = document.querySelectorAll('.alert-warning');
      securityAlerts.forEach(alert => {
        if (alert.textContent.includes('failed login attempts')) {
          alert.remove();
        }
      });
    });
  });
  
  // Add keyboard shortcut for quick access (Ctrl+Alt+A)
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.altKey && e.key === 'a') {
      e.preventDefault();
      document.getElementById('username').focus();
    }
  });
  
  // Simulate system status check
  setTimeout(() => {
    const activityItems = document.querySelectorAll('.activity-item');
    if (activityItems.length > 0) {
      const now = new Date();
      activityItems[0].innerHTML = `
        <span>Last successful login</span>
        <span>${now.toLocaleDateString()} ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
      `;
    }
  }, 1000);
});
</script>
{% endblock %}